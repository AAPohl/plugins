 <!DOCTYPE html>
{% extends "base.html" %}
{% block navbar %}
	{% with active_page="plugins" %}
	{% include "navbar.html" %}
	{% endwith %}
{% endblock navbar %}

{% block content %}
<div class="table-responsive">
	<table class="table table-striped table-hover pluginList">
		<thead>
			<tr class="shng_heading">
				<th style="width: 30px;"></th>
				<th style="width: 30px;"></th>
				<th style="width: 30px;">{{ _('Type') }}</th>
				<th style="width: 200px;">{{ _('Plugin') }}</th>
				<th style="width: 160x;">{{ _('Classname') }}</th>
				<th style="width: 200px;">{{ _('Instanz') }}</th>
				<th style="width: 150px;">{{ _('Version') }}</th>
				<th style="width: 150px;">{{ _('Mehrere Instanzen möglich') }}</th>
				<th style="width: 150px;">{{ _('Aktionen') }}</th>
				<th>{{ _('Web Interface') }}</th>
			</tr>
		</thead>
		<tbody>
			{% for p in plugins	 %}
			{% set outer_loop = loop %}
			<tr id="{{ loop.index }}_click" style="cursor: pointer;">
				<td class="py-1"><span style="color: {% if p.stopped %}red{% else %}green{% endif %};" class="fas {% if p.stopped %}fa-pause-circle{% else %}fa-play-circle{% endif %}"></span></td>
				<td class="py-1">
					{% if p.metadata.get_string('type') in ['web', 'protocol', 'interface', 'gateway', 'system'] %}
					<img src="static/img/{{ p.metadata.get_string('type') }}.svg" style="width: 25px;"/>
					{% else %}
					-
					{% endif %}
				</td>
				<td class="py-1" width="30px">{% if p.stopped %}<span style="color:#bbb;">{% endif %}{% if p.smartplugin %}SmartPlugin{%else%}Classic{%endif%}
				<td class="py-1">{% if p.stopped %}<span style="color:#bbb;">{% endif %}{{ p.shortname }}</td>
				<td class="py-1">{% if p.stopped %}<span style="color:#bbb;">{% endif %}{{ p.classname }}</td>
				{% if p.smartplugin %}
					{% set webifs = mod_http.get_webifs_for_plugin(p.shortname) %}
					<td class="py-1">
					{% if p.stopped %}<span style="color:#bbb;">{% endif %}{% if p.instancename %}{{ p.instancename }}{%else%}default{%endif%}
					</td>
					<td class="py-1">{% if p.stopped %}<span style="color:#bbb;">{% endif %}{{ p.metadata.get_string('version') }}</td>
					<td class="py-1">{% if p.stopped %}<span style="color:#bbb;">{% endif %}{% if p.multiinstance %}{{ _('Ja') }}{%else%}{{ _('Nein') }}{%endif%}</td>

					{% if updates or 1==1 %}
						<td class="py-1">
							{% if 1==2 %}
								<button {% if p.stopped %}disabled="true"{% endif %} name="trigger" title="{{ _('Auslösen','button') }}" class="btn btn-outline-dark btn-sm"><i class="fas fa-hand-pointer"></i></button>
							{% endif %}
							<button name="reload" title="{{ _('Neu Laden','button') }}" class="btn btn-outline-dark btn-sm"><i class="fas fa-sync"></i></button>
						{% if not p.stopped %}
							<button name="disable" title="{{ _('Deaktivieren','button') }}" class="btn btn-outline-dark btn-sm"><i class="fas fa-pause"></i></button>
						{% else %}
							<button name="enable" title="{{ _('Aktivieren','button') }}" class="btn btn-outline-dark btn-sm"><i class="fas fa-play"></i></button>
						{% endif %}
						{% if 1 == 2 %}
							<button name="unload" title="{{ _('Entladen', 'button') }}" class="btn btn-outline-dark btn-sm"><i class="fas fa-eject"></i></button>
							&nbsp; &nbsp; &nbsp;
							<button name="delete" title="{{ _('Löschen', 'button') }}" class="btn btn-outline-dark btn-sm" onClick="return confirm('{{_('Wollen Sie die Logik') }} \'{{ p.shortname }}\' {{ _('wirklich löschen?')}}');"><i class="far fa-trash-alt" aria-hidden="true" style="color: #c40808;"></i></button>
						{% endif %}
						</td>
					{% else %}
						<td class="py-1"></td>
					{% endif %}

					<td class="py-1">{% if not p.stopped %}
							{% for webif in webifs %}
								{% if webif['Instance'] == '' or webif['Instance'] == p.instancename %}
									<img id="webif_link_{{outer_loop.index}}_{{loop.index}}" src="static/img/html.svg" style="width: 25px;"/>
									<script>
										$('#webif_link_{{outer_loop.index}}_{{loop.index}}').click(function(e){
											window.open('http://{{mod_http.get_local_ip_address()}}:{{mod_http.get_local_port()}}/{{ webif['Webifname'] }}')
											e.stopPropagation();
										});
									</script>
								{%endif%}
							{% endfor %}
						{%endif%}
					</td>
				{% else %}
					<td class="py-1">-</td>
					<td class="py-1">-</td>
					<td class="py-1">-</td>
					<td class="py-1"></td>
					<td class="py-1"></td>
				{%endif%}
			</tr>
			<tr id="{{ loop.index }}_additional" style="display: none; cursor: pointer;">
				<td class="py-1" colspan="10">
					<div class="card">
						<div class="card-header p-1"><strong>{{ _('Plugin spezifische Attribute') }}:</strong></div>
						<div class="card-body p-1">
							<table class="table mb-0">
							{% set first = True %}
							{% for key, value in p.attributes.items() %}
								{% if loop.index % 2 > 0 %}
								<tr>
								{% endif %}
								{% if p['metadata'].get_parameter_type(key) != 'foo' %}
									<td class="p-0" style="width: 50%;">{{ key }} ( {{ p['metadata'].get_parameter_type_with_subtype(key) }} ): {{ value }}
									{% if p['metadata'].get_parameter_defaultvalue(key) == value %}
									&nbsp; [default]
									{% endif %}
									</td>
								{% else %}
									<td class="p-0" style="width: 400px;">{{ key }}: {{ value }}</td>
								{% endif %}
									{% if loop.index %2 > 0 and loop.last %}
									<td></td>
									{% endif %}
								{% if loop.index % 2 > 0 and not first %}
								</tr>
								{% else %}
								{% set first = False %}
								{% endif %}
							{% endfor %}
							</table>
						</div>
						<div class="card-header p-1"><strong>{{ _('Plugin Metadaten') }}:</strong></div>
						<div class="card-body p-1">
							{% if p.metadata.get_mlstring('description') %}
							{{ _('Beschreibung') }}: {{ p.metadata.get_mlstring('description') }}<br/>
							{% endif %}

							{% if p.metadata.get_string('documentation') %}
							{{ _('Documentation') }}:
							<a class="text-shng" target="_blank" href="{{ p.metadata.get_string('documentation') }}">{{ p.metadata.get_string('documentation') }}</a><br/>
							{% endif %}

							{% if p.metadata.get_string('support') %}
							{{ _('Support') }}:
							<a class="text-shng" target="_blank" href="{{ p.metadata.get_string('support') }}">{{ p.metadata.get_string('support') }}</a><br/>
							{% endif %}

							{{ _('Schlüsselwörter') }}:
							{% if p.metadata.get_string('keywords') %}
								{{ p.metadata.get_string('keywords') }}
							{% else %}
							-
							{% endif %}
							<br/>
							{{ _('Wartung') }}:
							{% if p.metadata.get_string('maintainer') %}
								{{ p.metadata.get_string('maintainer') }}
							{% else %}
							-
							{% endif %}
							<br/>
							{{ _('Tester') }}:
							{% if p.metadata.get_string('tester') %}
								{{ p.metadata.get_string('tester') }}
							{% else %}
							-
							{% endif %}
						</div>
					</div>
				</td>
			</tr>
			<script>
				/* If foldable content: add onclick for table row, stop unfolding when clicking pypi link inside. */
				$('#{{ loop.index }}_click').click(function(){
					$('#{{ loop.index }}_additional').toggle();
				});
				$('#{{ loop.index }}_additional').click(function(){
					$('#{{ loop.index }}_additional').toggle();
				});
			</script>
			{% endfor %}
		</tbody>
	</table>
</div>
{% endblock %}
