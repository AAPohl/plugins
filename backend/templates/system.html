 <!DOCTYPE html>
{% extends "base.html" %}
{% import "navbar.html" as nav with context %}
{% block navbar %}
    {{ nav }}
{% endblock navbar %}

{% block content %}
 <ul id="system_tabs" class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" href="#systemproperties">{{ _('Systemeigenschaften') }}</a></li>
  <li id="tab_pypi" class="disabled">
      <a href="#pypi">
          {{ _('PyPI Check') }}
          <i id="spinner" class="fa fa-circle-o-notch fa-spin fa-fw"></i>
  </a></li>
 </ul>
<div class="tab-content">
    <div id="systemproperties" class="tab-pane fade in active">
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th style="width: 100px;"></th>
                    <th style="width: 250px;">{{ _('Eigenschaft') }}</th>
                    <th>{{ _('Status') }}</th>
                </tr>
            </thead>
        <tbody>
            <tr>
                <td><img src="static/img/logo_small_76x76.png" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('SmartHomeNG Version') }}:</td>
                <td style="vertical-align: middle;">{{ sh_vers }}&nbsp;{{ _('in') }}&nbsp;{{ sh_dir }}&nbsp;&nbsp;-&nbsp;&nbsp;{{ _('Benutzer') }}:&nbsp;{{ user }}</td>
            </tr>
            <tr>
                <td><img src="static/img/logo_small_76x76.png" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('SmartHomeNG Plugins Version') }}:</td>
                <td style="vertical-align: middle;">{{ plg_vers }}&nbsp;{{ _('in') }}&nbsp;{{ sh_dir }}/plugins</td>
            </tr>
            <tr>
                <td><img src="static/img/terminal-server.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">Host:</td>
                <td style="vertical-align: middle;">{{ node }}&nbsp;&nbsp;-&nbsp;&nbsp;IPv4: {{ ip }}<!--&nbsp;&nbsp;-&nbsp;&nbsp;IPv6: {{ ipv6 }}--></td>
            </tr>
            <tr>
                <td><img src="static/img/tux_hdd.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Betriebssystem') }}:</td>
                <td style="vertical-align: middle;">{{ system }} {{ vers }}&nbsp;&nbsp;-&nbsp;&nbsp;{{ _('Architektur') }}:&nbsp;{{ arch }}</td>
            </tr>
            <tr>
                <td><img src="static/img/python.png" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Python Version') }}:</td>
                <td style="vertical-align: middle;">{{ pyversion }}</td>
            </tr>
            <tr>
                <td><img src="static/img/hd.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Freier Speicher') }}:</td>
                <td style="vertical-align: middle;">{{ (freespace)|round|int }} MByte</td>
            </tr>
            <tr>
                <td><img src="static/img/clock.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Datum') }} / {{ _('Zeit') }}:</td>
                <td style="vertical-align: middle;">{{ now }}</td>
            </tr>
            <tr>
                <td><img src="static/img/preferences.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Betriebszeit') }}:</td>
                <td style="vertical-align: middle;">Host:&nbsp;{{ uptime }}&nbsp;&nbsp;-&nbsp;&nbsp;SmartHomeNG:&nbsp;{{ sh_uptime }}</td>
            </tr>
        </tbody>
        </table>
    </div>
    </div>
    <div id="pypi" class="tab-pane fade">
    <div class="table-responsive" >
        <table id="package_check" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th style="width: 25%;">Python Package</th>
                    <th style="width: 25%;">{{ _('installierte Version') }}</th>
                    <th style="width: 25%;">{{ _('Anforderungen') }}</th>
                    <th style="width: 25%;">{{ _('Neuste Version') }} (PyPI)</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    </div>
</div>
 <script>
$(".disabled").click(function (e) {
        e.preventDefault();
        return false;
});

function activateTab(selector) {
    $(selector).on('click.twbstab',function() { $(this).tab('show'); })
        .closest('.disabled').removeClass('disabled');
}


$.getJSON('pypi.json', function(result) {
    $.each(result, function(index, element) {
        if (index == 0) {
            oldSort = element['sort'].substr(0,1);
            newSort = element['sort'].substr(0,1);
        } else {
            oldSort = newSort;
            newSort = newSort = element['sort'].substr(0,1);
        }
        if (oldSort != newSort) {
            $('#package_check').find("tbody").append("<tr><td style=\"font-weight:bold; background:#eee;\" colspan=\"5\">{{ _('Pakete ohne Requirements') }}</td></tr>");
        }

        fontWeight = '';
        if (element['is_required']) {
            fontWeight = "font-weight: bold;";
        }

        var fontColorPyPi = "green";
        var fontColorInstalled = "";
        var versionInstalledIcon = "";
        var versionInstalledText = "{{ _('Version nicht zul채ssig!') }}";

		if (element['is_required']) {
	        if (element['vers_ok']) {
                versionInstalledIcon = "fa-check-square-o";
                versionInstalledText = "{{ _('Version unterst체tzt!') }}";
	            if (element['vers_recent']) {
	    	        fontColorInstalled = "green";
	    	        if (element['pypi_version_ok']) {
	                    fontColorPyPi = "black";
	                } else {
	                    fontColorPyPi = "red";
	                }
	            } else {
	    	        fontColorInstalled = "black";
	    	    }
        	} else {
            	fontColorInstalled = "red";
            	var versionInstalledIcon = "fa-times-rectangle-o";
	        }
		} else {
            if (element['vers_recent']) {
    	        fontColorInstalled = "green";
	            fontColorPyPi = "black";
            } else {
    	        fontColorInstalled = "black";
    	    }
		}
        reqString = '';
        /* MIN and MAX filled, MIN != MAX */
        if (element['vers_req_min'] != '' && element['vers_req_max'] != '' && (element['vers_req_min'] != element['vers_req_max'])) {
            reqString += element['vers_req_min']+" <= <i class=\"fa "+versionInstalledIcon+"\" title=\"{{ _('installierte Version') }}\"></i>"
            if (reqString == "") {
            	reqString += "<i class=\"fa "+versionInstalledIcon+"\" title=\""+versionInstalledText+"\" style=\"color: "+fontColorInstalled+"\"></i>"
            }
            reqString += " <= "+element['vers_req_max'];
        }
        /* ELSE: MIN and MAX filled, MIN == MAX */
        else if (element['vers_req_min'] != '' && element['vers_req_max'] != '' && (element['vers_req_min'] == element['vers_req_max'])) {
            reqString += "<i class=\"fa "+versionInstalledIcon+"\" title=\""+versionInstalledText+"\"></i> == "+element['vers_req_min'];
        }
        /* ELSE: MIN or MAX filled */
        else {
            if (element['vers_req_min'] != '') {
                reqString += "<i class=\"fa "+versionInstalledIcon+"\" title=\""+versionInstalledText+"\"></i> "+" >= "+element['vers_req_min'];
            } else if (element['vers_req_max'] != '') {
                reqString += "<i class=\"fa "+versionInstalledIcon+"\" title=\""+versionInstalledText+"\"></i> "+"<= "+element['vers_req_max'];
            }
        }
		if (reqString == '') {
	        reqString = '-';
        }
        if (element['vers_req_souce'] != '') {
            reqTextString = element['vers_req_souce'];
        } else {
            reqTextString = "";
        }


        var table_row =  "<tr style=\"cursor: pointer;\" onClick=\"$('#"+index+"_requirements_detail').toggle();\">"+
            "<td style=\""+fontWeight+"\">"+element['name']+"</td>"+
            "<td style=\"color: "+fontColorInstalled+"\">"+element['vers_installed']+"</td>"+
            "<td>"+reqString+"</td>"+
            "<td style=\"color: "+fontColorPyPi+"\">"+element['pypi_version'];

		if (element['vers_recent'] != true && element['pypi_version_ok']) {
	        if ((element['pypi_version'] != '') && (element['pypi_version'] != element['vers_installed'])) {
    	        table_row += "&nbsp;<i class=\"fa fa-check-circle\" title=\"{{ _('Version unterst체tzt!') }}\"></i>";
        	}
        } else if (element['pypi_version'] != '-' && !element['pypi_version_ok']) {
            table_row += "&nbsp;<i class=\"fa fa-exclamation-circle\" title=\"{{ _('Version nicht zul채ssig!') }}\"></i>";
        }

        table_row += "</td></tr>";
        var table_row_requiremtents_detail = "<tr id=\""+index+"_requirements_detail\" "+
            "style=\"display: none; cursor: pointer; background: #333;\" onClick=\"$('#"+index+"_requirements_detail').toggle();\">"+
            "<td colspan=\"4\"><div class=\"panel panel-default\" style=\"margin-bottom: 5px;\">"+
            "<div class=\"panel-heading\">{{ _('Anforderungen') }} (requirements.txt)</div>"+
            "<div class=\"panel-body\">"+reqTextString+"</div></div><td></tr>";

        $('#package_check').find("tbody").append(table_row + table_row_requiremtents_detail);
    });
    $('#spinner').hide();
    $('#tab_pypi').removeClass("disabled");
    activateTab('#system_tabs a[href="#pypi"]');
});
</script>
{% endblock %}
