 <!DOCTYPE html>
{% extends "base.html" %}
{% import "navbar.html" as nav with context %}
{% block navbar %}
    {{ nav }}
{% endblock navbar %}

{% block content %}
 <ul id="system_tabs" class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" href="#systemproperties">{{ _('Systemeigenschaften') }}</a></li>
  <li id="tab_pypi" class="disabled">
      <a href="#pypi">
          {{ _('PyPI Check') }}
          <i id="spinner" class="fa fa-circle-o-notch fa-spin fa-fw"></i>
  </a></li>
 </ul>
<div class="tab-content">
    <div id="systemproperties" class="tab-pane fade in active">
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th style="width: 100px;"></th>
                    <th>{{ _('Eigenschaft') }}</th>
                    <th>{{ _('Status') }}</th>
                </tr>
            </thead>
        <tbody>
            <tr>
                <td><img src="static/img/logo_small_76x76.png" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('SmartHomeNG Version') }}:</td>
                <td style="vertical-align: middle;">{{ sh_vers }}&nbsp;{{ _('in') }}&nbsp;{{ sh_dir }}&nbsp;&nbsp;-&nbsp;&nbsp;{{ _('Benutzer') }}:&nbsp;{{ user }}</td>
            </tr>
            <tr>
                <td><img src="static/img/logo_small_76x76.png" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('SmartHomeNG Plugins Version') }}:</td>
                <td style="vertical-align: middle;">{{ plg_vers }}&nbsp;{{ _('in') }}&nbsp;{{ sh_dir }}/plugins</td>
            </tr>
            <tr>
                <td><img src="static/img/terminal-server.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">Host:</td>
                <td style="vertical-align: middle;">{{ node }}&nbsp;&nbsp;-&nbsp;&nbsp;IPv4: {{ ip }}<!--&nbsp;&nbsp;-&nbsp;&nbsp;IPv6: {{ ipv6 }}--></td>
            </tr>
            <tr>
                <td><img src="static/img/tux_hdd.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Betriebssystem') }}:</td>
                <td style="vertical-align: middle;">{{ system }} {{ vers }}&nbsp;&nbsp;-&nbsp;&nbsp;{{ _('Architektur') }}:&nbsp;{{ arch }}</td>
            </tr>
            <tr>
                <td><img src="static/img/python.png" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Python Version') }}:</td>
                <td style="vertical-align: middle;">{{ pyversion }}</td>
            </tr>
            <tr>
                <td><img src="static/img/hd.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Freier Speicher') }}:</td>
                <td style="vertical-align: middle;">{{ (freespace)|round|int }} MByte</td>
            </tr>
            <tr>
                <td><img src="static/img/clock.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Datum') }} / {{ _('Zeit') }}:</td>
                <td style="vertical-align: middle;">{{ now }}</td>
            </tr>
            <tr>
                <td><img src="static/img/preferences.svg" style="width: 36px; height: 36px; margin-left: 40px;"></td>
                <td style="vertical-align: middle;">{{ _('Betriebszeit') }}:</td>
                <td style="vertical-align: middle;">Host:&nbsp;{{ uptime }}&nbsp;&nbsp;-&nbsp;&nbsp;SmartHomeNG:&nbsp;{{ sh_uptime }}</td>
            </tr>
        </tbody>
        </table>
    </div>
    </div>
    <div id="pypi" class="tab-pane fade">
    <div class="table-responsive" >
        <table id="package_check" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th style="width: 15%;">Python Package</th>
                    <th style="width: 15%;">{{ _('installierte Version') }}</th>
                    <th style="width: 15%;">{{ _('Anforderungen') }}</th>
                    <th style="width: 40%;">{{ _('Anforderungen') }} (requirements.txt)</th>
                    <th style="width: 15%;">{{ _('Neuste Version') }} (PyPI)</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    </div>
</div>
 <script>
$(".disabled").click(function (e) {
        e.preventDefault();
        return false;
});

function activateTab(selector) {
    $(selector).on('click.twbstab',function() { $(this).tab('show'); })
        .closest('.disabled').removeClass('disabled');
}


$.getJSON('pypi.json', function(result) {
    $.each(result, function(index, element) {
        if (index == 0) {
            oldSort = element['sort'].substr(0,1);
            newSort = element['sort'].substr(0,1);
        } else {
            oldSort = newSort;
            newSort = newSort = element['sort'].substr(0,1);
        }
        if (oldSort != newSort) {
            $('#package_check').find("tbody").append("<tr><td style=\"font-weight:bold; background:#eee;\" colspan=\"5\">{{ _('Pakete ohne Requirements') }}</td></tr>");
        }

		if (element['required']) {
	        if (element['vers_ok']) {
    	        fontColor = "green";
        	} else {
            	fontColor = "red";
	        }
		} else {
   	        fontColor = "black";
		}
        if (element['pypi_forreq_ok']) {
            fontColorPyPi = "green";
        } else {
            fontColorPyPi = "red";
        }
        fontWeight = '';
        if (element['required']) {
            fontWeight = "font-weight: bold;";
        }
        reqString = '';
        if (element['vers_req_min'] != '') {
            reqString += "min: "+element['vers_req_min'];
        }
        if (element['vers_req_max'] != '') {
            reqString += "max: "+element['vers_req_max'];
        }
		if (reqString == '') {
	        reqString = '-';
        }
        if (element['vers_req_text'] != '') {
            reqTextString = element['vers_req_text'];
        } else {
            reqTextString = "";
        }


        var table_row =  "<tr><td style=\""+fontWeight+"\">"+element['name']+"</td>"+
            "<td style=\"color: "+fontColor+"\">"+element['vers_installed']+"</td>"+
            "<td>"+reqString+"</td>"+
            "<td>"+reqTextString+"</td>"+
            "<td style=\"color: "+fontColorPyPi+"\">"+element['pypi_version'];

        if (element['pypi_forreq_ok'] && (element['pypi_version'] != element['vers_installed'])) {
            table_row += "&nbsp;<i class=\"fa fa-bell-o\"></i>";
        }

        table_row += "</td></tr>";

        $('#package_check').find("tbody").append(table_row);
    });
    $('#spinner').hide();
    $('#tab_pypi').removeClass("disabled");
    activateTab('#system_tabs a[href="#pypi"]');
});
</script>
{% endblock %}
