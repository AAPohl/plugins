 <!DOCTYPE html>
{% extends "base.html" %}
{% import "navbar.html" as nav with context %}
{% block navbar %}
	{{ nav }}
{% endblock navbar %}

{% block content %}
<link rel="stylesheet" href="static/codemirror/lib/codemirror.css">
<link rel="stylesheet" href="static/codemirror/addon/display/fullscreen.css">
<link rel="stylesheet" href="static/codemirror/addon/hint/show-hint.css">
<link rel="stylesheet" href="static/css/codemirror_custom.css">
<link rel="stylesheet" href="static/codemirror/addon/dialog/dialog.css">
<link rel="stylesheet" href="static/codemirror/addon/search/matchesonscrollbar.css">
<script src="static/codemirror/lib/codemirror.js"></script>
<script src="static/codemirror/mode/python/python.js"></script>
<script src="static/codemirror/mode/xml/xml.js"></script>
<script src="static/codemirror/addon/display/fullscreen.js"></script>
<script src="static/codemirror/addon/hint/show-hint.js"></script>
<script src="static/codemirror/addon/hint/anyword-hint.js"></script>
<script src="static/codemirror/addon/dialog/dialog.js"></script>
<script src="static/codemirror/addon/search/searchcursor.js"></script>
<script src="static/codemirror/addon/search/search.js"></script>
<script src="static/codemirror/addon/scroll/annotatescrollbar.js"></script>
<script src="static/codemirror/addon/search/matchesonscrollbar.js"></script>
<script src="static/codemirror/addon/search/jump-to-line.js"></script>


<div class="container" style="width: 90%;">
	<h3>SmartHomeNG {{ _('Logik') }}: {{ logicname }}</h3>
	<strong>{{ _('Dateiname') }}:</strong> {{ file_path }}
	<br/><br/>
</div>

<div class="container">
	<div style="margin-bottom: 5px;">
	{% if updates %}
		<form name="input" action="logics_view.html" method="POST" enctype="multipart/form-data">
		<input type="hidden" name="logicname" readonly="true" value="{{ logicname }}" type="text"/>
		<input type="hidden" name="file_path" readonly="true" value="{{ file_path }}" type="text"/>
		<input {% if not thislogic.enabled %}disabled="true"{% endif %} name="trigger" value="{{ _('Auslösen','button') }}" type="submit" class="btn btn-default btn-xs"/>

		{% if thislogic.enabled %}
			<input name="disable" value="{{ _('Deaktivieren','button') }}" type="submit" class="btn btn-default btn-xs"/>
		{% else %}
			<input name="enable" value="{{ _('Aktivieren','button') }}" type="submit" class="btn btn-default btn-xs"/>
		{% endif %}
		&nbsp;|&nbsp;
		<input name="savereload" value="{{ _('Speichern_und_Neu_Laden','button') }}" type="submit" class="btn btn-default btn-xs"/>
		 |
		<input id="linewrapping" value="{{ _('Zeilenumbruch') }}" class="btn btn-default btn-xs active" onClick="switchLineWrapping();"/>
		<input id="help" value="{{ _('Hilfe') }}" class="btn btn-default btn-xs" onClick="$('#help_text').toggle();resizeCodeMirror()"/>
	{% endif %}
    </div>
	<div id="help_text" style="display:none;">
		<p>
		<ul>
			<li>
			{{ _('Strg + Space: Autovervollständigen von Python Befehlen. Strg + i: Autovervollständigen von Item-Pfaden.') }}<br/>
			</li>
			<li>
			{{ _('Drücken Sie F11 für den Vollbildmodus, wenn der Cursor im Editorfenster ist. Mit F11 oder ESC verlassen Sie den Vollbildmodus wieder.') }}
			</li>
			<li>{{_('Suche') }}:<ul>
				<li>{{ _('help_search_1') }}</li>
				<li>{{ _('help_search_2') }}</li>
				<li>{{ _('help_search_3') }}</li>
				<li>{{ _('help_search_4') }}</li>
				<li>{{ _('help_search_5') }}</li>
				<li>{{ _('help_search_6') }}</li>
				<li>{{ _('help_search_7') }}</li>
			</ul></li>
		</ul>
		</p>
	</div>

	<table class="table table-bordered table-hover table-striped">
		<tr>
			<td style="min-width:200px;"><strong>{{ _('Status') }}:</strong></td>
			<td><span style="color: {% if not thislogic.enabled %}red{% else %}green{% endif %};" class="fa {% if not thislogic.enabled %}fa-times-circle{% else %}fa-check-circle{% endif %}"></span>
			{% if not thislogic.enabled %}{{ _('Nicht aktiv') }}{% else %}{{ _('Aktiv') }}{% endif %}
			</td>
		</tr>
		<tr>
			<td><strong>{{ _('nächste Ausführung') }}</strong></td>
			<td>{% if not thislogic.enabled %}<span style="color:#bbb;">{% endif %}
				{{ thislogic.next_exec }}
				{% if not thislogic.enabled %}</span>{% endif %}
			</td>
		</tr>
		<tr>
			<td><strong>{{ _('Cycle') }}</strong></td>
			<td><input type="text" style="width: 200px; border: none" name="cycle" {% if not yaml_updates %}readonly="true"{% endif %} value="{{ thislogic.cycle }}"></td>
		</tr>
		<tr>
			<td><strong>{{ _('Crontab(s)') }}</strong></td>
			<td><input type="text" style="width: 450px; border: none" name="crontab" {% if not yaml_updates %}readonly="true"{% endif %} value="{{ thislogic.crontab }}"></td>
		</tr>
		<tr>
			<td><strong>{{ _('Watch_Item(s)') }}</strong></td>
			<td><input type="text" style="width: 900px; border: none" name="watch" {% if not yaml_updates %}readonly="true"{% endif %} value="{{ thislogic.watch_item }}"></td>
		</tr>
	</table>

	<div style="border: 1px solid #ccc; margin-bottom: 10px;">
		{% if logic_lines %}
<textarea id="logics_code" name="logics_code">{% for line in logic_lines %}{{ line }}
{% endfor %}</textarea>
			{% if updates %}</form>{% endif %}
		{% else %}{{ _('no data available') }}{% endif %}
	</div>
</div>
<script>
var logicsCodeMirror = CodeMirror.fromTextArea(document.getElementById("logics_code"), {
    lineNumbers: true,
    extraKeys: {
        "F11": function(cm) {
          logicsCodeMirror.getScrollerElement().style.maxHeight = 'none';
          cm.setOption("fullScreen", !cm.getOption("fullScreen"));
          if (!cm.getOption("fullScreen")) {
              resizeCodeMirror();
          }
        },
        "Esc": function(cm, fullScreen) {
          if (cm.getOption("fullScreen")) {
              cm.setOption("fullScreen", false);
              resizeCodeMirror();
          }
        },
        "Ctrl-Space": "autocomplete",
        "Ctrl-I": "autocomplete_item",
        "Alt-F": "findPersistent"
    },
    mode: "{{ mode }}",
    {% if not updates %}
    readOnly: true,
    {% endif %}
    lineSeparator: '\n',
    indentUnit: 4,
    lineWrapping: true,
    indentWithTabs: false
});

logicsCodeMirror.on("keyup", function (cm, event) {
        if (!cm.state.completionActive && /*Enables keyboard navigation in autocomplete list*/
            (event.keyCode != 8 &&
            event.keyCode != 13 &&
            event.keyCode != 37 &&
            event.keyCode != 38 &&
            event.keyCode != 39 &&
            event.keyCode != 40 &&
            event.keyCode != 46)) {
            CodeMirror.commands.autocomplete_item(cm, null, {completeSingle: false});
        }
    });
</script>
<script src="static/js/logics_view_functions.js"></script>
{% endblock %}

