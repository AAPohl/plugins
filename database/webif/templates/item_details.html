<!DOCTYPE html>
{% extends "base_plugin.html" %}

{% block headtable %}
<table class="table table-striped table-hover">
	<tbody>
		<tr>
			<td class="py-1" width="150px"><strong>{{ _('Verbunden') }}</strong></td>
			<td class="py-1">{% if p._db._connected %}{{ _('Ja') }}{% else %}{{ _('Nein') }}{% endif %}</td>
			<td class="py-1"></td>
			<td class="py-1"></td>
			<td class="py-1"></td>
			<td class="py-1"></td>
		</tr>
		{% set first = True %}
		{% for key, value in p._db._params.items() %}
		{% if loop.index % 4 == 0 %}
		<tr>
		{% endif %}
			{% if key != "passwd" %}
			<td class="py-1"><strong>{{ key }}</strong></td><td class="py-1">{{ value }}</td>
			{% else %}
			<td class="py-1"><strong>{{ key }}</strong></td><td class="py-1">{% for letter in value %}*{% endfor %}</td>
			{% endif %}
			{% if loop.index % 3 > 0 and loop.last %}
				<td class="py-1" colspan="{{ loop.index % 3 }}"></td>
			{% endif %}
		{% if loop.index % 4 == 0 and not first %}
		</tr>
		{% endif %}
		{% endfor %}
	</tbody>
</table>
{% endblock headtable %}

{% block buttons %}
<button type="button" class="btn btn-shng btn-sm" onclick="window.open('db.dump')">{{ _('Datenbank-Dump') }}</button>
<button type="button" class="btn btn-shng btn-sm" onclick="location.href='?'">{{ _('Übersicht') }}</button>
{% endblock buttons %}

{% block bodytab1 %}
<script type="text/javascript" language="javascript">
function confirmDelete(url, text) {
	if (confirm(text)) {
		window.location.href=url;
	}
	return false;
}
</script>

{% if action == 'delete_log' %}
	<div class="mb-2 alert alert-success alert-dismissible fade show" role="alert">
		<strong>{{ _('Löschauftrag für die Einträge von Item ID') }} {{ item_id }} {{ _('in der Tabelle "log" wurde erfolgreich initiiert!') }}</strong><br/>
		{{ _('Das Löschen kann noch kurze Zeit dauern, da die DELETE Anfrage erst nach Abschluß der bestehenden Transaktionen erfolgen kann.') }}
		<button type="button" class="close" data-dismiss="alert" aria-label="Close">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>
{% endif %}

<div class="mb-2">
	{{ _('Die folgenden Einträgen entstammen der log Tabelle mit historischen Daten für das Item') }} {{ item_path }} {{_('(Datenbank-ID') }}: {{ item_id }}):
</div>
<table class="table table-striped table-hover pluginList">
	<thead>
	<tr>
		<th>{{ _('Zeit') }}</th>
		<th>{{ _('Item ID') }}</th>
		<th>{{ _('Dauer') }}</th>
		<th>VAL_STR</th>
		<th>VAL_NUM</th>
		<th>VAL_BOOL</th>
		<th>{{ _('Geändert') }}</th>
	</tr>
	</thead>
	{% for dataset in log_array %}
		<tr>
			<td class="py-1">{{ dataset[0].strftime('%d.%m.%Y %H:%M:%S') }}</td>
			<td class="py-1">{{ dataset[1] }}</td>
			<td class="py-1">{{ dataset[2] }}</td>
			<td class="py-1">{{ dataset[3] }}</td>
			<td class="py-1">{{ dataset[4] }}</td>
			<td class="py-1">{{ dataset[5] }}</td>
			<td class="py-1">{{ dataset[6].strftime('%d.%m.%Y %H:%M:%S') }}</td>
		</tr>
	{% endfor %}
</table>
{% endblock bodytab1 %}
